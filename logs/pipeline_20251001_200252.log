A:\pilim\Downloads\Financiero\run_pipeline.py:130: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  start_time = datetime.utcnow()
2025-10-01 22:02:52,307 INFO === RUN PIPELINE START 2025-10-01T20:02:52.307266 UTC ===
2025-10-01 22:02:52,307 INFO Stage=fetch attempt 1/2
2025-10-01 22:02:52,307 INFO Ejecutando: 'C:\Users\pilim\AppData\Local\Programs\Python\Python313\python.exe' 1_fetch_indicators.py
2025-10-01 22:04:50,110 INFO Salida (1_fetch_indicators.py): returncode=0 (t=117.8s)
2025-10-01 22:04:50,110 WARNING stderr: 2025-10-01 22:02:53,009 INFO Starting fetch for 1147 tickers in batches of 200 (workers=8)
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:266: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df = pd.read_csv(p, index_col=0, parse_dates=True)
2025-10-01 22:02:53,016 ERROR Failed to load cache for ARX
Traceback (most recent call last):
  File "A:\pilim\Downloads\Financiero\1_fetch_indicators.py", line 267, in load_cache
    if df.index.tz is None:
       ^^^^^^^^^^^
AttributeError: 'Index' object has no attribute 'tz'
2025-10-01 22:02:53,023 INFO Batch 1/6: downloading 200 tickers (of 200)
2025-10-01 22:02:54,178 ERROR HTTP Error 404: 
2025-10-01 22:02:54,576 ERROR HTTP Error 404: 
2025-10-01 22:03:00,500 ERROR 
32 Failed downloads:
2025-10-01 22:03:00,500 ERROR ['BNP', 'BMW', 'COL', 'CIE', 'AYV', 'ANA', 'CABK', 'ACS', 'CEZ', 'AF']: YFPricesMissingError('possibly delisted; no price data found  (period=60d)')
2025-10-01 22:03:00,500 ERROR ['AMNB', 'BP.LS', 'AGUA', 'BAS', 'CAP', 'AYDEN', 'ADS', 'ALFAA', 'BC8', 'BHIA3', 'BAYN', 'BBSE3', 'ALO', 'CMIN3', 'CERN', 'CNC.MI', 'CBK', 'CHK', 'CPFE3', 'ANTM', 'AIXA']: YFPricesMissingError('possibly delisted; no price data found  (period=60d) (Yahoo error = "No data found, symbol may be delisted")')
2025-10-01 22:03:00,500 ERROR ['ARX']: YFPricesMissingError('possibly delisted; no price data found  (period=60d) (Yahoo error = "15m data not available for startTime=1753363800 and endTime=1759349061. The requested range must be within the last 60 days.")')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indicators.py:394: FutureWarning: 'H' is deprecated and will be removed in a future version, please use 'h' instead.
  df2h = df.resample('2H').agg(agg).dropna(how='any')
A:\pilim\Downloads\Financiero\1_fetch_indica
2025-10-01 22:04:50,110 INFO Stage fetch completado correctamente.
2025-10-01 22:04:50,111 INFO Stage=score attempt 1/2
2025-10-01 22:04:50,111 INFO Ejecutando: 'C:\Users\pilim\AppData\Local\Programs\Python\Python313\python.exe' 2_score_select.py
2025-10-01 22:04:50,629 INFO Salida (2_score_select.py): returncode=0 (t=0.5s)
2025-10-01 22:04:50,629 WARNING stderr: 2025-10-01 22:04:50,536 WARNING Could not read parquet intermediate/indicators.parquet: Unable to find a usable engine; tried using: 'pyarrow', 'fastparquet'.
A suitable version of pyarrow or fastparquet is required for parquet support.
Trying to import the above resulted in these errors:
 - Missing optional dependency 'pyarrow'. pyarrow is required for parquet support. Use pip or conda to install pyarrow.
 - Missing optional dependency 'fastparquet'. fastparquet is required for parquet support. Use pip or conda to install fastparquet.
2025-10-01 22:04:50,544 INFO Loaded indicators from csv: intermediate/indicators.csv (rows=1098)
2025-10-01 22:04:50,553 INFO Hard filters: passed=11 rejected=1087 total=1098
2025-10-01 22:04:50,565 INFO Wrote rejected sample to intermediate\rejected_sample.csv
2025-10-01 22:04:50,573 INFO Scoring computed. Score stats: min=22.53 median=31.40 max=58.19
2025-10-01 22:04:50,576 INFO Selected top 6 per sector -> 11 rows
2025-10-01 22:04:50,582 INFO Wrote selected csv: intermediate/candidates.csv
2025-10-01 22:04:50,584 INFO Wrote sheet-ready CSV: intermediate/candidates.sheet_ready.csv
2025-10-01 22:04:50,584 INFO SUMMARY: total_indicators=1098 passed=11 selected=11 rejected=1087
2025-10-01 22:04:50,584 INFO Sector=COMMODITIES -> RHM.DE, STRL, GATX
2025-10-01 22:04:50,585 INFO Sector=ENERGIA -> DVN, MPC
2025-10-01 22:04:50,585 INFO Sector=FINANCIERO -> BHF, CFG, JXN
2025-10-01 22:04:50,585 INFO Sector=SALUD -> ADUS
2025-10-01 22:04:50,585 INFO Sector=TECNOLOGÍA -> QCOM, GFS
2025-10-01 22:04:50,629 INFO Stage score completado correctamente.
2025-10-01 22:04:50,629 INFO Stage=export attempt 1/2
2025-10-01 22:04:50,630 INFO Ejecutando: 'C:\Users\pilim\AppData\Local\Programs\Python\Python313\python.exe' 3_export_sheets.py
2025-10-01 22:05:13,034 INFO Salida (3_export_sheets.py): returncode=0 (t=22.4s)
2025-10-01 22:05:13,034 WARNING stderr: 2025-10-01 22:04:51,274 INFO export_sheets: CONFIG: creds_path=creds/gsheets-service.json spreadsheet_id=1e8fOwMOn-EkmsAAdN4Ybo1YS8RcUAHuXZ5SHns2DHTo candidates=intermediate/candidates.sheet_ready.csv sheets=['SALUD', 'ENERGIA', 'COMMODITIES', 'TECNOLOGÍA', 'FINANCIERO']
2025-10-01 22:04:51,275 INFO export_sheets: Leyendo candidates desde: intermediate/candidates.sheet_ready.csv
2025-10-01 22:04:51,278 INFO export_sheets: Usando columna de sector: Sector
2025-10-01 22:04:51,279 INFO export_sheets: Autenticando gspread con creds/gsheets-service.json
2025-10-01 22:04:52,327 INFO export_sheets: Spreadsheet abierto: Trades
2025-10-01 22:04:52,327 INFO export_sheets: Procesando hoja config: 'SALUD'
2025-10-01 22:04:55,749 INFO export_sheets: Escribiendo bloque en 'SALUD' rango A8:H8 (cols=8) filas=1 (tickers: ADUS)
A:\pilim\Downloads\Financiero\3_export_sheets.py:355: DeprecationWarning: The order of arguments in worksheet.update() has changed. Please pass values first and range_name secondor used named arguments (range_name=, values=)
  ws.update(range_to_update, merged_rows, value_input_option=cfg.get("append_value_input_option", "USER_ENTERED"))
2025-10-01 22:04:56,523 INFO export_sheets: Hoja 'SALUD': escritas 1 filas correctamente (preservando columnas derecha).
2025-10-01 22:04:56,523 INFO export_sheets: Procesando hoja config: 'ENERGIA'
2025-10-01 22:04:58,259 INFO export_sheets: Ticker MPC omitido en 'ENERGÍA' por duplicado reciente.
2025-10-01 22:04:59,602 INFO export_sheets: Escribiendo bloque en 'ENERGÍA' rango A8:H8 (cols=8) filas=1 (tickers: DVN)
A:\pilim\Downloads\Financiero\3_export_sheets.py:355: DeprecationWarning: The order of arguments in worksheet.update() has changed. Please pass values first and range_name secondor used named arguments (range_name=, values=)
  ws.update(range_to_update, merged_rows, value_input_option=cfg.get("append_value_input_option", "USER_ENTERED"))
2025-10-01 22:05:00,336 INFO export_sheets: Hoja 'ENERGÍA': escritas 1 filas correctamente (preservando columnas derecha).
2025-10-01 22:05:00,336 INFO export_sheets: Procesando hoja config: 'COMMODITIES'
2025-10-01 22:05:02,439 INFO export_sheets: Ticker RHM.DE omitido en 'COMMODITIES' por duplicado reciente.
2025-10-01 22:05:02,439 INFO export_sheets: Ticker STRL omitido en 'COMMODITIES' por duplicado reciente.
2025-10-01 22:05:03,904 INFO export_sheets: Escribiendo bloque en 'COMMODITIES' rango A9:H9 (cols=8) filas=1 (tickers: GATX)
A:\pilim\Downloads\Financiero\3_export_sheets.py:355: DeprecationWarning: The order of arguments in worksheet.update() has changed. Please pass values first and range_name secondor used named arguments (range_name=, values=)
  ws.update(range_to_update, merged_rows, value_input_option=cfg.get("append_value_input_option", "USER_ENTERED"))
2025-10-01 22:05:04,611 INFO export_sheets: Hoja 'COMMODITIES': escritas 1 filas correctamente (preservando columnas derecha).
2025-10-01 22:05:04,612 INFO export_sheets: Procesando hoja config: 'TECNOLOGÍA'
2025-10-01 22:05:06,814 INFO export_sheets: Ticker GFS omitido en 'TECNOLOGÍA' por duplicado reciente.
2025-10-01 22:05:08,152 INFO export_sheets: Escribiendo bloque en 'TECNOLOGÍA' rango A8:H8 (cols=8) filas=1 (tickers: QCOM)
A:\pilim\Downloads\Financiero\3_export_sheets.py:355: DeprecationWarning: The order of arguments in worksheet.update() has changed. Please pass values first and range_name secondor used named arguments (range_name=, values=)
  ws.update(range_to_update, merged_rows, value_input_option=cfg.get("append_value_input_option", "USER_ENTERED"))
2025-10-01 22:05:08,822 INFO export_sheets: Hoja 'TECNOLOGÍA': escritas 1 filas correctamente (preservando columnas derecha).
2025-10-01 22:05:08,822 INFO export_sheets: Procesando hoja config: 'FINANCIERO'
2025-10-01 22:05:10,941 INFO export_sheets: Ticker CFG omitido en 'FINANCIERO' por duplicado reciente.
2025-10-01 22:05:12,296 INFO export_sheets: Escribiendo bloque en 'FINANCIERO' rango A7:H8 (cols=8) filas=2 (tic
2025-10-01 22:05:13,034 INFO Stage export completado correctamente.
A:\pilim\Downloads\Financiero\run_pipeline.py:146: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  end_time = datetime.utcnow()
2025-10-01 22:05:13,035 INFO === RUN PIPELINE END 2025-10-01T20:05:13.035439 UTC (duración 140.7 s) ===
2025-10-01 22:05:13,391 INFO Resumen candidatos: total=11 (preview):
2025-10-01 22:05:13,396 INFO TICKER      PRECIO    ATR 2H      EMA 15      EMA 50     EMA 150       MFI       RSI  ENTRADA 1  ENTRADA 2  STOP  TARGET 1  TARGET 2  MONTO  G/P  G/P POT%    _Score      Sector
RHM.DE 1948.500000 22.285714 1955.589113 1940.537137 1856.870615 45.926497 47.704562        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 58.194125 COMMODITIES
  STRL  337.920013  6.640710  340.432797  336.836248  311.133272 44.267559 46.815045        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 52.098269 COMMODITIES
  GATX  174.690002  1.259642  174.959143  173.654587  168.329933 52.183827 49.642009        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 27.265435 COMMODITIES
   DVN   35.314999  0.532200   35.380269   35.248360   34.810785 45.061274 49.320255        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 49.072767     ENERGIA
   MPC  192.350006  2.184629  193.407690  190.289889  182.524003 40.027169 48.583761        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 33.398782     ENERGIA
   BHF   53.200001  0.733801   53.792448   52.555613   49.995489 45.002632 46.975489        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 31.395154  FINANCIERO
   CFG   52.744999  0.594572   52.932232   52.733123   51.432472 52.351931 47.862040        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 28.893967  FINANCIERO
   JXN  101.269997  1.189327  101.608755  100.746296   97.559758 54.835834 48.799548        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 24.691065  FINANCIERO
  ADUS  115.779999  1.323494  116.786812  114.915621  113.424464 27.433892 48.194124        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 28.369323       SALUD
  QCOM  166.490005  1.575965  166.615890  166.414657  162.426388 34.872310 47.355860        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 40.978972  TECNOLOGÍA
   GFS   34.490002  0.871028   35.227534   34.232891   34.300262 41.393417 47.404248        NaN        NaN   NaN       NaN       NaN    NaN  NaN       NaN 22.528155  TECNOLOGÍA

PROCESS EXIT CODE: 0
